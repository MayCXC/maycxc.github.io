<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>FOUROHFOUR</title>
    <script type="application/x-javascript">
/*
 * -- Puke Inhibitor --
 * Copyright (C) 1997 By Simon T. Kirby.
 * Released to the public domain.  No warranty!
 * Have fun. :)
 *
 * Original was from about 1994, in Turbo Pascal.
 *
 * Ported to C and svgalib in 1997.
 *
 * Ported to Javascript and Canvas, 2009/08/10.
 *
 * Golfed a little by ajp in 2020.
 */

var ctx, w, w2, h, h2, zf;

var starcount = 300;
var starbuffer = [];
var angle = [0,0,0];
var ofs = [0,0,0];
var fps = 60;

function resize() {
	var canvas = document.getElementById('canvas');
	w = canvas.width = window.innerWidth;
	h = canvas.height = window.innerHeight;
	w2 = w / 2;
	h2 = h / 2;
	zf = (w + h) / 5;
	ctx = canvas.getContext('2d');
}

function init() {
	resize();
	if (!!ctx) {
        for (i = 0;i < starcount;i++) {
            starbuffer[i] = [
                Math.round(Math.random()*65535) - 32768,
                Math.round(Math.random()*65535) - 32768,
                Math.round(Math.random()*65535) - 32768
            ]
        }

        setInterval(draw,1000. / fps);
    }
}

function dot(l, r) {
    var d = 0.0;
    for(var i=0; i<Math.min(l.length,r.length); i+=1) {
        d += l[i]*r[i];
    }
    return d;
}

function ttt(l, r) {
    var t = [];
    for(var i=0; i<Math.min(l.length,r.length); i+=1) {
        t[i] = l[i]+r[i];
    }
    return t;
}

function draw() {
    var s = angle.map(Math.sin);
    var c = angle.map(Math.cos);

    var m = [
        [c[0]*c[1]                  , -s[1]     , -s[0]*c[1]                 ],
        [s[0]*s[2] + s[1]*c[2]*c[0] ,  c[1]*c[2],  s[2]*c[0] - s[0]*s[1]*c[2]],
        [s[0]*c[2] - s[1]*s[2]*c[0] , -s[2]*c[1],  c[0]*c[2] + s[0]*s[1]*s[2]]
    ];

	ctx.fillStyle = 'rgb(255,255,255)';
	ctx.clearRect(0,0,w,h);

	for (var i = 0; i < starcount; i++) {
        var a = ttt(starbuffer[i], ofs).map(t => t<<16>>16);
		var z = dot(a,m[2]) + 32768;
		if (z > 0) {
			var xp = Math.round(dot(a,m[0]) * zf / z) + w2;
			var yp = Math.round(dot(a,m[1]) * zf / z) + h2;
			if (xp >= 0 && xp < w && yp >= 0 && yp < h) {
				var zp = Math.min(32768 / z + 0.1, 6);
				ctx.fillRect(xp,yp,zp,zp);
			}
		}
	}

    angle = ttt(angle, [11 / 4096. * Math.PI,13 / 4096. * Math.PI,7 / 4096. * Math.PI]);
    ofs = ttt(ofs, [-179*2, -101*2, -137*2]);
}
 </script>
 <style type="text/css">
	html, body { margin: 0; padding: 0; color: #ccc; background: #000; }
	body { font-family: sans-serif; font-size: 13px; }
	div { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); }
	.fourohfour { font-size:404%; position: relative; width: 50%; margin-left: auto; margin-right: auto; }
	.fourohfour:before, .fourohfour:after {
		position: absolute;
		content: attr(data-text);
		top: 0;
	}
	.fourohfour:before {
		left: 2px;
		text-shadow: -1px 0 red;
		background: #000;
		animation: fourohfour 2s infinite linear alternate-reverse;
	}
	.fourohfour:after {
		clip: rect(20px, 400px, 30px, 0);
		left: -2px;
		text-shadow: -1px 0 green;
		background: #000;
		animation: fourohfourtwo 2s infinite linear alternate-reverse;
	}
	@keyframes fourohfourtwo {
		0% { clip: rect(10px, 400px, 15px, 0); }
		20% { clip: rect(400px, 400px, 41px, 0); }
		40% { clip: rect(25px, 400px, 26px, 0); }
		60% { clip: rect(10px, 400px, 15px, 0); }
		80% { clip: rect(26px, 400px, 29px, 0); }
		100% { clip: rect(40px, 400px, 45px, 0); }
	}
	@keyframes fourohfour {
		0% { clip: rect(30px, 400px, 40px, 0); }
		20% { clip: rect(26px, 400px, 28px, 0); }
		40% { clip: rect(15px, 400px, 100px, 0); }
		60% { clip: rect(40px, 400px, 45px, 0); }
		80% { clip: rect(10px, 400px, 18px, 0); }
		100% { clip: rect(40px, 400px, 50px, 0); }
	}

	.strider { font-size: 101%; opacity: 0; animation: fadein 2625ms ease-in 2250ms forwards; }
	.strider:after {
		overflow:hidden;
		display: inline-block;
		vertical-align: bottom;
		animation: strider steps(4,end) 1875ms 8750ms infinite;
		content: "...";
		width: 0;
		margin-right: 1.26em;
	}
	@keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
	@keyframes strider { to { width: 1.26em; margin-right: 0; } }

	canvas { position: absolute; }
 </style>
</head>
<body onload="init();" onresize="resize();">
 <div>
  <h1 class="fourohfour" data-text="404">404</h1>
  <h4 class="strider">Not all those who wander are lost</h4>
 </div>
 <canvas id="canvas" width="320" height="240">(but you definitely are)</canvas>
 <audio autoplay><source src="/web/20161230105022im_/http://desu.duckdns.org/404.mp3" type="audio/mp3"></audio>
</body>
</html>
